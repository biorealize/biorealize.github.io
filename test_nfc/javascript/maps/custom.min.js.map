{"version":3,"sources":["custom.js"],"names":["pubnub","PubNub","subscribeKey","publishKey","jQuery","document","ready","$","subscribe","channels","addListener","message","m","channelName","channel","console","log","append","JSON","stringify","type","val","tag","click","e","$this","currentTarget","is","attr","show","hide","switchPlate","filter","i","d","find","eq","focus","plate","change","submit","preventDefault","experiment","fields","length","peripheral_type","load","each","row","chr","String","fromCharCode","j","td","sealed","syringe","sendTag","retrieveTag","$c","t","config","window","location","hostname","apiUrl","tagObj","cmnd","data","publish","meta","getMeta","uuid","getUUID","v"],"mappings":"AAAA,aAEA,IAAAA,OAAA,IAAAC,OAAA,CACAC,aAAA,6CACAC,WAAA,+CAEAC,OAAAC,UAAAC,MAAA,SAAAC,GACAP,OAAAQ,UAAA,CACAC,SAAA,CAAA,oBAEAT,OAAAU,YAAA,CACAC,QAAA,SAAAC,GACA,IAAAC,EAAAD,EAAAE,QACAC,QAAAC,IAAA,oBAAAJ,GACAG,QAAAC,IAAAH,GACAN,EAAA,QAAAU,OAAA,MAAAC,KAAAC,UAAAP,EAAAD,SAAA,QAEA,OAAAC,EAAAD,QAAAS,MACAb,EAAA,kBAAAc,IAAAH,KAAAC,UAAAP,EAAAD,QAAAW,SAIAf,EAAA,0BAAAgB,MAAA,SAAAC,GACA,IAAAC,EAAAlB,EAAAiB,EAAAE,eAEAD,EAAAE,GAAA,cACA,oBAAAF,EAAAG,KAAA,OACArB,EAAA,uCAAAsB,OACAtB,EAAA,kBAAAuB,OACAC,IACAxB,EAAA,UAAAyB,OAAA,SAAAC,EAAAC,GACA,OAAA3B,EAAA2B,GAAAP,GAAA,cAEAQ,KAAA,SAAAC,GAAA,GAAAC,UAEA9B,EAAA,wDAAAuB,OACAvB,EAAA,kBAAAsB,WAKA,IAAAE,EAAA,WAGA,GAFAxB,EAAA,mBAAAuB,OAEAvB,EAAA,qBAAAoB,GAAA,YAAA,CACA,IAAAW,EAAA/B,EAAA,oBAAAc,MACAd,EAAA,IAAA+B,GAAAT,SAIAtB,EAAA,oBAAAgC,OAAAR,GAAAQ,SACAhC,EAAA,oBAAAiC,OAAA,SAAAhB,GACAA,EAAAiB,iBAKA,IAJA,IAAAC,EAAA,GACAjB,EAAAlB,EAAAiB,EAAAE,eACAiB,EAAA,CAAA,KAAA,SAAA,WAAA,aAAA,WAAA,qBAAA,qBAEAV,EAAA,EAAAA,EAAAU,EAAAC,OAAAX,IACAS,EAAAC,EAAAV,IAAAR,EAAAU,KAAA,IAAAQ,EAAAV,IAAAZ,MAGA,GAAA,SAAAI,EAAAU,KAAA,kCAAAd,MAAA,CACAqB,EAAAG,gBAAApB,EAAAU,KAAA,oBAAAd,MACA,IAAAyB,EAAA,GACArB,EAAAU,KAAA,2BAAAA,KAAA,SACAA,KAAA,MAAAY,KAAA,SAAAd,EAAAe,GACA,IAAAC,EAAAC,OAAAC,aAAA,GAAAlB,GACA1B,EAAAyC,GAAAb,KAAA,MAAAY,KAAA,SAAAK,EAAAC,GACAP,EAAAG,EAAAG,GAAA7C,EAAA8C,GAAAlB,KAAA,oBAAAd,UAGAqB,EAAAI,KAAAA,EACAJ,EAAAY,OAAA,QAAA7B,EAAAU,KAAA,8BAAAd,WAEAqB,EAAAa,QAAA9B,EAAAU,KAAA,YAAAd,MAGAd,EAAA,cAAAc,IAAAH,KAAAC,UAAAuB,IACAc,QAAAd,KAEAnC,EAAA,qBAAAiC,OAAA,SAAAhB,GACAA,EAAAiB,iBACAgB,YAAAlD,EAAA,eAAAc,WAIA,IAAAqC,GAAA,SAAAC,GACA5C,QAAAC,IAAA2C,IAGAC,OAAA,WACA,IAAAA,EAAA,GASA,MAPA,IAAAC,OAAAC,SAAAC,SAEAH,EAAAI,OAAA,wBAEAJ,EAAAI,OAAA,2BAGAJ,GAGAJ,QAAA,SAAAS,GACA,IAAAtD,EAAA,CACAuD,KAAA,UACAC,KAAAF,GAEAjE,OAAAoE,QAAA,CACAzD,QAAAA,EACAG,QAAA,SACAuD,KAAAC,aAIAb,YAAA,SAAAnC,GACA,IAAAX,EAAA,CACAuD,KAAA,UACAC,KAAA7C,GAEAtB,OAAAoE,QAAA,CACAzD,QAAAA,EACAG,QAAA,SACAuD,KAAAC,aAIAA,QAAA,WACA,MAAA,CACAC,KAAAvE,OAAAwE,UACAC,EAAA","file":"../custom.min.js","sourcesContent":["\"use strict\";\n\nvar pubnub = new PubNub({\n  subscribeKey: \"sub-c-0b2aaa44-a779-11e6-be20-0619f8945a4f\",\n  publishKey: \"pub-c-722b1270-6c2b-423d-98f6-cb21c18a2265\"\n});\njQuery(document).ready(function ($) {\n  pubnub.subscribe({\n    channels: ['NFC_TAG_CLIENT']\n  });\n  pubnub.addListener({\n    message: function message(m) {\n      var channelName = m.channel;\n      console.log('message came in: ', m);\n      console.log(channelName);\n      $('#log').append('<p>' + JSON.stringify(m.message) + '</p>');\n\n      if (m.message.type == 'get') {\n        $('#json_received').val(JSON.stringify(m.message.tag));\n      }\n    }\n  });\n  $('input[name=media_type]').click(function (e) {\n    var $this = $(e.currentTarget);\n\n    if ($this.is(':checked')) {\n      if ($this.attr('id') == 'media_type_solid') {\n        $('#peripheral_type_group, #sealed_row').show();\n        $('#syringe_group').hide();\n        switchPlate();\n        var table = $('.plate').filter(function (i, d) {\n          return $(d).is(':visible');\n        });\n        table.find('input').eq(0).focus(); //$('.plate').is(':visible').find('input').eq(0).focus()\n      } else {\n        $('#peripheral_type_group, .form-row.plate, #sealed_row').hide();\n        $('#syringe_group').show();\n      }\n    }\n  });\n\n  var switchPlate = function switchPlate() {\n    $('.form-row.plate').hide();\n\n    if ($('#media_type_solid').is(':checked')) {\n      var plate = $('#peripheral_type').val();\n      $('#' + plate).show();\n    }\n  };\n\n  $('#peripheral_type').change(switchPlate).change();\n  $('#submit_nfc_form').submit(function (e) {\n    e.preventDefault();\n    var experiment = {};\n    var $this = $(e.currentTarget);\n    var fields = ['id', 'client', 'location', 'start_time', 'duration', 'target_temperature', 'imaging_frequency'];\n\n    for (var i = 0; i < fields.length; i++) {\n      experiment[fields[i]] = $this.find('#' + fields[i]).val();\n    }\n\n    if ($this.find('input[name=media_type]:checked').val() == 'solid') {\n      experiment.peripheral_type = $this.find('#peripheral_type').val();\n      var load = {};\n      var $plate = $this.find('.form-row.plate:visible').find('table');\n      $plate.find('tr').each(function (i, row) {\n        var chr = String.fromCharCode(65 + i);\n        $(row).find('td').each(function (j, td) {\n          load[chr + j] = $(td).find('input[type=text]').val();\n        });\n      });\n      experiment.load = load;\n      experiment.sealed = $this.find('input[name=sealed]:checked').val() == 'true';\n    } else {\n      experiment.syringe = $this.find('#syringe').val();\n    }\n\n    $('#json_sent').val(JSON.stringify(experiment));\n    sendTag(experiment);\n  });\n  $('#request_nfc_form').submit(function (e) {\n    e.preventDefault();\n    retrieveTag($('#request_id').val());\n  });\n});\n\nvar $c = function $c(t) {\n  console.log(t);\n};\n\nvar config = function config() {\n  var config = {};\n\n  if (window.location.hostname == '') {\n    //this is for local testing with local MongoDB\n    config.apiUrl = 'http://localhost:4001';\n  } else {\n    config.apiUrl = 'http://18.191.34.33:4000';\n  }\n\n  return config;\n};\n\nvar sendTag = function sendTag(tagObj) {\n  var message = {\n    cmnd: 'ADD_NFC',\n    data: tagObj\n  };\n  pubnub.publish({\n    message: message,\n    channel: 'SERVER',\n    meta: getMeta()\n  });\n};\n\nvar retrieveTag = function retrieveTag(tag) {\n  var message = {\n    cmnd: 'GET_NFC',\n    data: tag\n  };\n  pubnub.publish({\n    message: message,\n    channel: 'SERVER',\n    meta: getMeta()\n  });\n};\n\nvar getMeta = function getMeta() {\n  return {\n    'uuid': pubnub.getUUID(),\n    'v': 1\n  };\n};\n/*\n{ \"experiment\" :\n\t{\n\tid: 79E4464,\n\t\"client\" : \"Lacolombe\",\n\t\"location\" : 19102,\n\t\"start_time:\" : Monday08April2019_09/37/28AM,\n\t\"duration\" : 3600,\n\t\"peripheral_type\" : \"6_well_plate\",\n\t\"load\":\n\t     [\n{\n\t\t\"A1\" : organismA\",\n\t\t\"A2\" : organismB\",\n\t\t\"A3\" : organismC\",\n\t\t\"B1\" : organismD\",\n\t\t\"B2\" : organismE\",\n\t\t\"B3\" : organismF\",  \n\t\t}\n     ],\n\t\"target_temperature\" : 37,\n\t\"imaging_frequency\" : 3600,\n\t\"end_time\": <filled when completed>\n\t}\n}\n*/"]}