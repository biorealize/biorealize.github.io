<!DOCTYPE HTML>
<html>
    <head>
    <title>Biorealize: Microbial Design Studio</title>

    <link rel="stylesheet" href="//code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" />


    <link rel="stylesheet" href="stylesheets/html5reset.css" media="all">
    <link rel="stylesheet" href="stylesheets/style.css" />
    <link rel="stylesheet" href="stylesheets/col.css" media="all">
    <link rel="stylesheet" href="stylesheets/4cols.css" media="all"/>
    <link rel="stylesheet" href="stylesheets/2cols.css" media="all"/>

    <!-- Responsive and mobile friendly -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- JQuery -->
    <script src="//code.jquery.com/jquery-1.11.0.min.js" type="text/javascript" ></script>
    <!-- SVG lib -->    
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/2.5.0/svg.js" type="text/javascript"></script>

    <script type="text/javascript" src="javascripts/snap.svg.js"></script>

    <!-- Functions -->    
    <script type="text/javascript" src="javascripts/functions.js"></script>

    <!-- CanvasJS -->
    <script src="http://canvasjs.com/assets/script/canvasjs.min.js"></script>

    <!-- This is the MQTT related section -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js" type="text/javascript"></script>

    <!-- SVG Graphics -->    
   <script type="text/javascript" src="javascripts/graphics.js"></script>   
    
    <script type="text/javascript">

  // Create a client instance
  // m10.cloudmqtt.com

  //client = new Paho.MQTT.Client("m11.cloudmqtt.com", 39547, "web_" + parseInt(Math.random() * 100, 10));

  client = new Paho.MQTT.Client("m10.cloudmqtt.com", 37282, "web_" + parseInt(Math.random() * 100, 10));


  // set callback handlers
  client.onConnectionLost = onConnectionLost;
  client.onMessageArrived = onMessageArrived;

  var options = {
    useSSL: true,
    userName: "buwynvxd",
    //userName: "bpbgifio",
    //password: "TaxZFQ5IkTjE",
    password: "AhFmFn2ibFAS",
    onSuccess:onConnect,
    onFailure:doFail
  }

  // connect the client
  client.connect(options);

  // called when the client connects
  function onConnect() {
    // Once a connection has been made, make a subscription and send a message.
    console.log("onConnect");
    client.subscribe("/#");       
    message = new Paho.MQTT.Message("Hello CloudMQTT"); //InteractiveCommand.Agitate(1)
    message.destinationName = "/MDS/Interactive";
    client.send(message); 
  }

  function doFail(e){
    console.log(e);
  }

  // called when the client loses its connection
  function onConnectionLost(responseObject) {
    if (responseObject.errorCode !== 0) {
      console.log("onConnectionLost:"+responseObject.errorMessage);

    }
  }

  // called when a message arrives
  function onMessageArrived(message) {

    //console.log("onMessageArrived: "+ message.payloadString);

    var receivedTopic = message.payloadString.split(':')[0];
    //document.getElementById("status").innerHTML = message.payloadString ; 


    if ( !machineDriveEnabled && receivedTopic =='Echo'){
        angle = message.payloadString.split(':')[1];
        animateWheel(angle*-1, 250);
    }

    

    //document.getElementById("status").innerHTML = receivedMessage ; 

    //document.getElementById("status").innerHTML =  "<span style=\"color:#355ea3\">" + message.payloadString + "</span>";; 


  }

    /*  
    function sendMachineMessage(m) {
        if (client) { 
            var topic = m.split(":")[0].substr(1); // get the @ prefix as a topic
            var message = new Paho.MQTT.Message(m);
            message.destinationName = "/MDS";
            if (topic.length > 0) message.destinationName = message.destinationName + "/" + topic;
            client.send(message);        
        }
    }
    */

        function sendMachineMessage(m) {
        if (client) { 
            //var topic = '/MDS/+'
            var message = new Paho.MQTT.Message(m);
            message.destinationName = "/MDS/Interactive";
            //if (topic.length > 0) message.destinationName = message.destinationName + "/" + topic;
            client.send(message);        
        }
    }

    /*Functions added for GUI */

    function sendInterfaceMessage(m1, m2){

        document.getElementById("status").innerHTML =  "<span style=\"color:#355ea3\">" + m1 + "</span>" + '&nbsp &nbsp &nbsp &nbsp'+ "<span style=\"color:black\">" + m2 + "</span>"; ; 

    }



  
</script>   


    </head>

       <body >
        
        <div id="pageheader">
            <img src="images/biorealizelogo.svg" alt="Microbial Design Studio" class="center"> 
        </div>

        <hr class="style_two">

        <div id="messages"></div>

        <div class="section group">
            <div class="col span_1_of_2">
                    <svg id="mdsDrawing"></svg> 
               <!-- <div class="machineDrawing"></div>  --> 
                
            </div>
            <div class="col span_1_of_2">
                 <div id="chartContainer">Analytics</div>   
            </div>
        </div>

        
        <hr class="style_one">

        <div id="status">Waiting to connect...
        </div>

        <div class="section group">
                </div>
                <div class="section group">
                    
                    <div class="col span_1_of_4">
                        <div class = "designmenu">
                        Design
                        
                        <hr class="style_one">

                        <p> Start &nbsp &nbsp &nbsp   &nbsp  &nbsp &nbsp &nbsp  &nbsp &nbsp &nbsp Electroporator &nbsp &nbsp &nbsp &nbsp &nbsp Enable Machine Drive </p>
                        

                        <button type="button" id="initPlatfomButton" = onclick='initPlatformButtonFunction();'> Init Platform </button>

                        <button type="button" id="openElectroporatorLid" = onclick='openElectroporatorLidButtonFunction();'> Open</button>
                         <button type="button" id="closeElectroporatorLid" = onclick='closeElectroporatorLidButtonFunction();'> Close </button>

                        <input type="checkbox" id="driveMachineCheckbox" = onclick='handleDriveMachineCheckboxClick(this);'>

                        <hr class="style_one">

                        <p> Select Syringe </p>

                        <select id="selectExperimentMenu">
                        <option value="1"> 1 </option>
                        <option value="2"> 2 </option>
                        <option value="3"> 3 </option>
                        <option value="4"> 4 </option>
                        <option value="5"> 5 </option>
                        <option value="6"> 6 </option>
                        <option value="7"> 7 </option>
                        <option value="8"> 8</option>
                        </select>


                        <hr class="style_one">

                        <p> Load Syringes </p>
                        
                        <button type="button" id="startChangeSyringeButton" = onclick='startChangeSyringeButtonFunction();'>  Start Change Syringe -> </button>

                        <button type="button" id="stopChangeSyringeButton" = onclick='stopChangeSyringeButtonFunction();'> Stop Change Syringe -> </button>
                        
                        <hr class="style_one">

                        <p> Start Experiments</p>

                        <button type="button" id="selectExperimentButton" = onclick='runExperimentButtonFunction();'> Run -> </button>

                        <hr class="style_one">
                        </div>
                    </div> 


                    <div class="col span_1_of_4">

                        <div class = "culturemenu">
                        Culture

                        <hr class="style_one">

                        <p> Load Syringes with Media </p>


                        <button type="button" id="loadMediaButton" onclick= "loadMediaButtonFunction();" > Load Media -> </button>  

                        <hr class="style_one">


                         <p> Load Syringes with Organism </p>

                        <button type="button" id="LoadOrganismButton" onclick= "loadOrganismButtonFunction();" > Load Organism -> </button> 
                        
                        <hr class="style_one">


                         <p> Incubate Syringes for </p>

                        <select id="incubateDurationMenu">
                        <option value="30:00"> 30 min </option>
                        <option value="60:00"> 60 min </option>
                        <option value="06:00:00"> 6 hrs </option>
                        <option value="12:00:00"> 12 hrs </option>
                        <option value="24:00:00"> 24 hrs </option>
                        </select>

                        <button type="button" id="incubateStartButton" onclick= "incubateStartButtonFunction();" > Start -> </button> 
                        <button type="button" id="incubateStopButton" onclick= "incubateStopButtonFunction();" > Stop -> </button> 

                        <hr class="style_one">

                         <p> Unload Experiment</p>

                        <button type="button" id="unloadExperimentButton" onclick= "unloadExperimentButtonFunction();" > Unload Experiment -> </button> 
                        
                        <hr class="style_one">

                        </div>
                    </div>

                    <div class="col span_1_of_4">
                        <div class = "analyzemenu">
                        Analyze
                        
                        <hr class="style_one">



                        <p> Display Spec for &nbsp  &nbsp &nbsp &nbsp &nbsp Sampling Duration</p>

                        <select id="displaySpecForExperimentMenu">
                        <option value="1"> 1 </option>
                        <option value="2"> 2 </option>
                        <option value="3"> 3 </option>
                        <option value="4"> 4 </option>
                        <option value="5"> 5 </option>
                        <option value="6"> 6 </option>
                        <option value="7"> 7 </option>
                        <option value="8"> 8 </option>
                        </select>
                        
                        <select id="specSamplingDurationMenu">
                        <option value="01:00"> 1 min </option>
                        <option value="10:00"> 10 mins </option>
                        <option value="30:00"> 30 mins </option>
                        <option value="60:00"> 60 mins </option>
                        </select>

                    
                        <hr class="style_one">  

                         <p> Spectrometer Settings</p>

                        <button type="button" onclick='specShowFunction();'>Show Spec</button>
                        <!--<button type="button" onclick='specStartFunction();'>Start</button>-->
                        <!--<button type="button" onclick='specStopFunction();'>Stop</button>-->
                        <button type="button" onclick='specRawSpectrumFunction();'>Raw Spectrum</button>

                        <hr class="style_one">

                        <p> Optional Features </p>
                        <button type="button" onclick='specLightOnFunction();'>Light On</button>
                        <button type="button" onclick='specLightOffFunction();'>Light Off</button>
                        <button type="button" onclick='specUVOnFunction();'>UV On</button>
                        <button type="button" onclick='specUVOffFunction();'>UV Off</button>

                        <hr class="style_one">  


                        </div>
                    </div> 
                    <!--
                    <div class="col span_1_of_4">
                        <div class = "configuremenu">
                        Configure
                        <br>
                        
                        <hr class="style_one">

                        <p> Spectrometer Calibration </p>

                        
                        SN: <input type="text" size="3" id="serialNum" >
                        A0: <input type="text" size="3" id="A0">
                        B1: <input type="text" size="3" id="B1">
                        B2: <input type="text" size="3" id="B2">
                        B3: <input type="text" size="3" id="B3">
                        B4: <input type="text" size="3" id="B4">
                        B5: <input type="text" size="3" id="B5">

                        &nbsp  <button type="button" id="setSpecCalibration" onclick= "setSpecCalibrationButtonFunction();" > Set </button>  
                        
                        <hr class="style_one">                        
                        
                        <p> Clock Period &nbsp &nbsp Integration Time</p>

                        <input type="text" id="clockPeriod" value="20us" size="8"> 
                        <input type="text" id="integrationTime" size="8">      
                        <button type="button" onclick='setClockPeriodButtonFunction;'> -></button>
                        
                         <hr class="style_one">

                        </div>
                        --> 
                    </div>

                </div>

                 <hr class="style_one">
                        <!-- Responsive and mobile friendly 
                        <p> Debug Command &nbsp &nbsp &nbsp  &nbsp &nbsp   &nbsp&nbsp  &nbsp  &nbsp  &nbsp&nbsp  &nbsp  &nbsp  &nbsp  Simulation Control </p>

                        <input type="text" id="rawCommandForDebug" value="@___:___;" size="20"> 
                        <button type="button" onclick='sendRawCommandFunction();'> -></button>
                        

                        <button type="button" onclick='sendMachineMessage("@electroporator:SIMULATION_ON;");'>Simulation On</button>
                        <button type="button" onclick='sendMachineMessage("@electroporator:SIMULATION_OFF;");'>Simluation Off</button>  

                <hr class="style_one"> 
                --> 
                <div id="pagefooter">Biorealize Inc. 2017 | MDS v.5 | CC-BY-SA 4.0 </div>
                        <!-- The analytics chart is loaded here from CanvasJS --> 


    </body>
</html>
